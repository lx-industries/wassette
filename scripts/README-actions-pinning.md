# GitHub Actions Version Pinning Scripts

This directory contains scripts for managing version pinning of GitHub Actions in workflow files.

## Overview

Version pinning is a security best practice for GitHub Actions workflows. It involves using commit SHAs instead of version tags (like `@v4`) to reference actions, preventing unwanted or malicious updates.

## Scripts

### pin-actions.sh

Pins GitHub Actions to their commit SHAs in `.lock.yml` files generated by `gh-aw`.

**Usage:**
```bash
./scripts/pin-actions.sh
```

**What it does:**
- Replaces tag-based references (e.g., `actions/checkout@v5`) with SHA-based references (e.g., `actions/checkout@08c6903cd8c0fde910a37f88322edcfb5dd907a8 # v5.0.0`)
- Processes all `.lock.yml` files in `.github/workflows/`
- Adds version comments for better readability

### add-version-comments.sh

Adds version comments to already-pinned GitHub Actions that don't have them.

**Usage:**
```bash
./scripts/add-version-comments.sh
```

**What it does:**
- Adds version comments (e.g., `# v5.0.0`) to SHA-pinned actions
- Ensures consistency across all workflow files
- Improves readability by indicating which version each SHA corresponds to

## When to Use

Run these scripts:
1. After compiling agentic workflows with `gh aw compile`
2. When updating to new versions of GitHub Actions
3. When version comments are missing from pinned actions

## Security Benefits

- **Immutability**: Commit SHAs cannot be changed, preventing tag hijacking
- **Supply Chain Security**: Reduces risk of malicious code injection
- **Audit Trail**: Version comments make it clear which version is being used

## Updating Pinned Versions

To update to newer versions of actions:

1. Find the new SHA for the desired version:
   ```bash
   gh api repos/actions/checkout/git/refs/tags/v5.0.0 | jq -r '.object.sha'
   ```

2. Update the SHA mapping in `pin-actions.sh`

3. Run the script to apply the changes

## Supported Actions

Currently pinned actions:
- `actions/checkout` (v5.0.0)
- `actions/cache` (v4.2.0, v4.3.0)
- `actions/setup-node` (v4.2.0, v4.4.0)
- `actions/upload-artifact` (v4.6.2)
- `actions/download-artifact` (v5.0.0)
- `actions/github-script` (v8.0.0)

## References

- [GitHub Actions Security Best Practices](https://docs.github.com/en/actions/security-guides/security-hardening-for-github-actions)
- [Why Pin GitHub Actions](https://www.codewrecks.com/post/github/github-sha-pinning/)
